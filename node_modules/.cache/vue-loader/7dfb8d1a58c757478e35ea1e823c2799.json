{"remainingRequest":"/Users/hw/work/memberVueD/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hw/work/memberVueD/src/views/Member/CreateQrCode.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hw/work/memberVueD/src/views/Member/CreateQrCode.vue","mtime":1552384689500},{"path":"/Users/hw/work/memberVueD/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hw/work/memberVueD/node_modules/cache-loader/dist/cjs.js","mtime":1552395991950},{"path":"/Users/hw/work/memberVueD/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nvar _this;\nlet djs=null;//倒计时\nlet timerCheck=null;\nexport default {\n    props: {\n        paramData:Object,\n        defult:{}\n    },\n    data(){\n        return{\n            isLoading:false,\n            isShowQcode:false,\n            isTimer:0,\n            orderNo:'',\n            qrcodePath:'',\n            minute:'',\n            second:'',\n            isEnd:false,\n        }\n    },\n    methods: {\n        mInit() {\n            let param={\n                apiid:this.paramData.apiid,\n                serviceType:this.paramData.serviceType,\n                apitypeid:this.paramData.apitypeid,\n                orderAmount:this.paramData.orderAmount,\n            };\n            this.isLoading = true;\n            this.$http.post(this.paramData.url,param).then((result) => {\n                this.mLoading(false);\n                if(result.code=='0')\n                {\n                    this.isTimer=result.data.isTimer;\n                    this.orderNo=result.data.orderNo;\n                    this.qrcodePath=result.data.qrcoDepath;\n                    this.isShowQcode=true;\n                    if ( this.isTimer * 1 >0)\n                    {\n                        this.timer();\n                    }\n                    this.timerCheck= setTimeout(()=>{this.checkorder()}, 10000);\n                    //console.log(result.data);\n                }else{\n                    this.mClose();\n                }\n                this.isLoading = false;\n            }).catch(error=>{\n                this.mClose();\n            });\n        },\n        timer(){\n             this.djs = window.setInterval( () =>{\n                var d = 0,\n                    h = 0;\n                    //minute = 0,\n                   // second = 0;//时间默认值\n                if (this.isTimer > 0) {\n                    this.minute = Math.floor(this.isTimer / 60) - (d * 24 * 60) - (h * 60);\n                    this.second = Math.floor(this.isTimer) - (d * 24 * 60 * 60) - (h * 60 * 60) - (this.minute * 60);\n                }\n                this.isTimer--;\n                if (this.isTimer <= 0) {\n                    this.isEnd=true;\n                    if (this.djs != null) {\n                        window.clearInterval(this.djs);\n                    }\n                    if (this.timerCheck != null) {\n                        clearTimeout(this.timerCheck);\n                    }\n                }\n            }, 1000);\n        },\n        checkorder()\n        {\n             this.$http.post(\"/recharge/rechargeState.json?id=\"+this.orderNo,{}).then((result) => {\n                 if(result.code==0)\n                 {\n                     if(result.data==1 || result.data==3)\n                     {\n                        this.mAlert(\"恭喜，充值成功！\",()=>{this.mClose()},\"success\");\n                        if (this.timerCheck != null) {\n                            clearTimeout(this.timerCheck);\n                        }\n                     }\n                     else if(result.data==2)\n                     {\n                        this.mAlert(\"抱歉，充值失败请联系客服！\",()=>{this.mClose()},\"error\");\n                        if (this.timerCheck != null) {\n                            clearTimeout(this.timerCheck);\n                        }\n                     }\n                     else {\n                        this.timerCheck=setTimeout(()=>{this.checkorder()}, 2000);\n                    }\n                 }\n                 else {\n                    this.timerCheck=setTimeout(()=>{this.checkorder()}, 2000);\n                }\n             });\n        },\n        mClose() {\n            this.$emit(\"closecallback\");\n        },\n    },\n    created() {\n        _this = this;\n        this.mInit();\n    },\n    destroyed() {\n        _this = undefined;\n        if (this.djs != null) {\n            window.clearInterval(this.djs);\n        }\n        if (this.timerCheck != null) {\n            clearTimeout(this.timerCheck);\n        }\n    }\n}\n",{"version":3,"sources":["CreateQrCode.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CreateQrCode.vue","sourceRoot":"src/views/Member","sourcesContent":["<template>\n  <div>\n    <div\n      class=\"codeContent\"\n      v-if=\"!isEnd\"\n    >\n      <div style='width: 247px; height: 247px; margin: 0 auto; padding-top: 10px;'>\n        <img\n          v-if=\"isShowQcode\"\n          :src=\"cApi+'/payQRCoder.do?payUrl='+qrcodePath\"\n          style=\"width:247px; height:247px;\"\n        />\n        <!-- <img :src=\"qrcodePath\"  style=\"width:247px; height:247px;\" /> -->\n      </div>\n      <div style=\"font-weight:bold;color:red;text-align:center;padding-top:10px;\">付款及时到账，二维码请勿重复使用</div>\n      <div v-if=\"isTimer>0\">\n        <div\n          style=\"font-weight:bold;text-align:left;padding-left:38px;padding-top:10px;\"\n          v-text=\"'订单号：'+orderNo\"\n        ></div>\n        <div style=\"font-weight:bold;color:green;padding-left:38px;padding-top:10px;\">付款二维码有效时间:\n          <strong><s></s> {{minute}} 分</strong>\n          <strong><s></s> {{second}} 秒</strong>\n        </div>\n      </div>\n      <Spin\n        fix\n        v-if=\"isLoading\"\n      >\n        <Icon\n          type=\"load-c\"\n          size=18\n          class=\"demo-spin-icon-load\"\n        ></Icon>\n        <div>处理中...</div>\n      </Spin>\n    </div>\n    <div\n      class=\"codeContent\"\n      v-if=\"isEnd\"\n    >\n      <div style='margin:0 auto; width:340px;padding-top:20px; text-align:center; color:#ccc;font-weight:bold; font-size:32px;'>\n        <p>付款二维码已过期</p>\n        <p>请重新生成付款码</p>\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nvar _this;\nlet djs=null;//倒计时\nlet timerCheck=null;\nexport default {\n    props: {\n        paramData:Object,\n        defult:{}\n    },\n    data(){\n        return{\n            isLoading:false,\n            isShowQcode:false,\n            isTimer:0,\n            orderNo:'',\n            qrcodePath:'',\n            minute:'',\n            second:'',\n            isEnd:false,\n        }\n    },\n    methods: {\n        mInit() {\n            let param={\n                apiid:this.paramData.apiid,\n                serviceType:this.paramData.serviceType,\n                apitypeid:this.paramData.apitypeid,\n                orderAmount:this.paramData.orderAmount,\n            };\n            this.isLoading = true;\n            this.$http.post(this.paramData.url,param).then((result) => {\n                this.mLoading(false);\n                if(result.code=='0')\n                {\n                    this.isTimer=result.data.isTimer;\n                    this.orderNo=result.data.orderNo;\n                    this.qrcodePath=result.data.qrcoDepath;\n                    this.isShowQcode=true;\n                    if ( this.isTimer * 1 >0)\n                    {\n                        this.timer();\n                    }\n                    this.timerCheck= setTimeout(()=>{this.checkorder()}, 10000);\n                    //console.log(result.data);\n                }else{\n                    this.mClose();\n                }\n                this.isLoading = false;\n            }).catch(error=>{\n                this.mClose();\n            });\n        },\n        timer(){\n             this.djs = window.setInterval( () =>{\n                var d = 0,\n                    h = 0;\n                    //minute = 0,\n                   // second = 0;//时间默认值\n                if (this.isTimer > 0) {\n                    this.minute = Math.floor(this.isTimer / 60) - (d * 24 * 60) - (h * 60);\n                    this.second = Math.floor(this.isTimer) - (d * 24 * 60 * 60) - (h * 60 * 60) - (this.minute * 60);\n                }\n                this.isTimer--;\n                if (this.isTimer <= 0) {\n                    this.isEnd=true;\n                    if (this.djs != null) {\n                        window.clearInterval(this.djs);\n                    }\n                    if (this.timerCheck != null) {\n                        clearTimeout(this.timerCheck);\n                    }\n                }\n            }, 1000);\n        },\n        checkorder()\n        {\n             this.$http.post(\"/recharge/rechargeState.json?id=\"+this.orderNo,{}).then((result) => {\n                 if(result.code==0)\n                 {\n                     if(result.data==1 || result.data==3)\n                     {\n                        this.mAlert(\"恭喜，充值成功！\",()=>{this.mClose()},\"success\");\n                        if (this.timerCheck != null) {\n                            clearTimeout(this.timerCheck);\n                        }\n                     }\n                     else if(result.data==2)\n                     {\n                        this.mAlert(\"抱歉，充值失败请联系客服！\",()=>{this.mClose()},\"error\");\n                        if (this.timerCheck != null) {\n                            clearTimeout(this.timerCheck);\n                        }\n                     }\n                     else {\n                        this.timerCheck=setTimeout(()=>{this.checkorder()}, 2000);\n                    }\n                 }\n                 else {\n                    this.timerCheck=setTimeout(()=>{this.checkorder()}, 2000);\n                }\n             });\n        },\n        mClose() {\n            this.$emit(\"closecallback\");\n        },\n    },\n    created() {\n        _this = this;\n        this.mInit();\n    },\n    destroyed() {\n        _this = undefined;\n        if (this.djs != null) {\n            window.clearInterval(this.djs);\n        }\n        if (this.timerCheck != null) {\n            clearTimeout(this.timerCheck);\n        }\n    }\n}\n</script>"]}]}